{% extends "base.html" %}

{% block title %}PathFinder - Set Your Preferences{% endblock %}

{% block content %}
<div class="preferences-container">
    <div class="preferences-card">
        <h1 class="text-center mb-4">Set Your Route Preferences</h1>

        <form id="preferences-form" class="preferences-form">
            <section class="form-section">
                <h3>Basic Preferences</h3>
                
                <div class="form-group">
                    <label class="form-label">Preferred Route Type</label>
                    <div class="btn-group" role="group">
                        <input type="radio" id="type-road" name="route_type" value="road" 
                               {% if preferences.route_type == 'road' %}checked{% endif %}>
                        <label for="type-road" class="btn btn-outline-primary">Road Running</label>
                        
                        <input type="radio" id="type-trail" name="route_type" value="trail"
                               {% if preferences.route_type == 'trail' %}checked{% endif %}>
                        <label for="type-trail" class="btn btn-outline-primary">Trail Running</label>
                        
                        <input type="radio" id="type-mixed" name="route_type" value="mixed"
                               {% if preferences.route_type == 'mixed' %}checked{% endif %}>
                        <label for="type-mixed" class="btn btn-outline-primary">Mixed Terrain</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Elevation Preference</label>
                    <select name="elevation_preference" class="form-control">
                        <option value="flat" {% if preferences.elevation_preference == 'flat' %}selected{% endif %}>
                            Flat Routes
                        </option>
                        <option value="moderate" {% if preferences.elevation_preference == 'moderate' %}selected{% endif %}>
                            Moderate Hills
                        </option>
                        <option value="challenging" {% if preferences.elevation_preference == 'challenging' %}selected{% endif %}>
                            Challenging Climbs
                        </option>
                    </select>
                </div>
            </section>

            <section class="form-section">
                <h3>Surface & Environment</h3>
                
                <div class="form-group">
                    <label class="form-label">Preferred Surface</label>
                    <select name="surface_preference" class="form-control">
                        <option value="asphalt" {% if preferences.surface_preference == 'asphalt' %}selected{% endif %}>
                            Asphalt/Pavement
                        </option>
                        <option value="dirt" {% if preferences.surface_preference == 'dirt' %}selected{% endif %}>
                            Dirt/Trail
                        </option>
                        <option value="grass" {% if preferences.surface_preference == 'grass' %}selected{% endif %}>
                            Grass/Park Paths
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Traffic Preference</label>
                    <select name="traffic_preference" class="form-control">
                        <option value="avoid" {% if preferences.traffic_preference == 'avoid' %}selected{% endif %}>
                            Avoid High Traffic
                        </option>
                        <option value="neutral" {% if preferences.traffic_preference == 'neutral' %}selected{% endif %}>
                            No Preference
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Crowd Preference</label>
                    <select name="crowd_preference" class="form-control">
                        <option value="quiet" {% if preferences.crowd_preference == 'quiet' %}selected{% endif %}>
                            Quiet/Isolated Routes
                        </option>
                        <option value="social" {% if preferences.crowd_preference == 'social' %}selected{% endif %}>
                            Social/Populated Areas
                        </option>
                    </select>
                </div>
            </section>

            <section class="form-section">
                <h3>Safety Features</h3>
                
                <div class="form-group">
                    <label class="form-checkbox">
                        <input type="checkbox" name="require_lighting" 
                               {% if preferences.require_lighting %}checked{% endif %}>
                        Prefer well-lit routes
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-checkbox">
                        <input type="checkbox" name="require_sidewalks"
                               {% if preferences.require_sidewalks %}checked{% endif %}>
                        Require sidewalks/pedestrian paths
                    </label>
                </div>
            </section>

            <button type="submit" class="btn btn-primary w-100">Save Preferences</button>
            <a href="{{ url_for('routes.search_page') }}" class="btn btn-outline-secondary w-100 mt-2">Back to Search</a>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('preferences-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    
    try {
        const response = await fetch('/api/preferences', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(Object.fromEntries(formData))
        });
        
        if (!response.ok) throw new Error('Failed to save preferences');
        
        window.location.href = "{{ url_for('routes.search_page') }}";
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to save preferences. Please try again.');
    }
});
</script>
{% endblock %}